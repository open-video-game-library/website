# æ¯æ—¥0æ™‚ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONã«åæ˜ ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
name: å®šæœŸãƒ‡ãƒ¼ã‚¿æ›´æ–°

on:
  workflow_dispatch:
  schedule:
    - cron: "0 15 * * *" # NOTE: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯UTC

env:
  API_INTERNAL_DB_URL: ${{secrets.API_INTERNAL_DB_URL}}
  API_EXTERNAL_DB_URL: ${{secrets.API_EXTERNAL_DB_URL}}
  API_SURVEY_DB_URL: ${{secrets.API_SURVEY_DB_URL}}

jobs:
  update_datas:
    name: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    runs-on: ubuntu-latest
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      - name: JSãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹YAMLã‚’å®Ÿè¡Œ
        uses: ./.github/actions/update-datas
        id: import-data
      - name: ABOUTãƒšãƒ¼ã‚¸ã§èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        uses: jsdaniell/create-json@v1.2.2
        with:
          name: assets/json/about.json
          json: ${{ steps.import-data.outputs.about }}
      - name: GAMEãƒšãƒ¼ã‚¸ã§èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        uses: jsdaniell/create-json@v1.2.2
        with:
          name: assets/json/game.json
          json: ${{ steps.import-data.outputs.game }}
      - name: ã‚µãƒ¼ãƒ™ã‚¤ãƒšãƒ¼ã‚¸ã§èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        uses: jsdaniell/create-json@v1.2.2
        with:
          name: assets/json/survey.json
          json: ${{ steps.import-data.outputs.survey }}
      - name: TOOLãƒšãƒ¼ã‚¸ã§èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        uses: jsdaniell/create-json@v1.2.2
        with:
          name: assets/json/tool.json
          json: ${{ steps.import-data.outputs.tool }}
      - name: TOOLè©³ç´°ãƒšãƒ¼ã‚¸ã§èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
        uses: jsdaniell/create-json@v1.2.2
        with:
          name: assets/json/extool.json
          json: ${{ steps.import-data.outputs.extool }}
      - name: å·®åˆ†ã‚’ãƒãƒ¼ã‚¸
        run: |
          git config --global user.email "ttttt.fms5@gmail.com"
          git config --global user.name "tkawa15"
          if (git diff --shortstat | grep '[0-9]'); then \
            git add .
            git commit -m "ğŸš€ å®šæœŸãƒ‡ãƒ¼ã‚¿æ›´æ–°"
            git push origin HEAD
          fi
      - name: é™çš„ãƒ“ãƒ«ãƒ‰
        run: |
          npm run install
          npm run generate
      - name: GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./.output/public
          cname: openvideogame.cc
          user_name: tkawa15
          user_email: ttttt.fms5@gmail.com
